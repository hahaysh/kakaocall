@{
    ViewData["Title"] = "순번 호출";
    string selectedNumber = ViewBag.SelectedNumber as string ?? "";
    string phone = ViewBag.Phone as string ?? "";
    string message = ViewBag.Message as string ?? "";
    string defaultMessage = ViewBag.DefaultMessage as string ?? "[전화번호] 님의 순번 [순번] 의 순서가 되었습니다. 식당 입구로 와주세요.";
}

<div class="text-center">
    <h1 class="display-4">순번 호출</h1>
    <form asp-action="Call" method="post">
        <div class="form-group">
            <label for="Number">순번</label>
            <select class="form-control" id="Number" name="Number" required onchange="updateMessage()">
                <option value="">순번 선택</option>
                @for (int i = 1; i <= 10; i++)
                {
                    if (selectedNumber == i.ToString())
                    {
                        <option value="@i" selected>@i</option>
                    }
                    else
                    {
                        <option value="@i">@i</option>
                    }
                }
            </select>
        </div>
        <div class="form-group mt-2">
            <label for="Phone">전화번호</label>
            <input type="text" class="form-control" id="Phone" name="Phone" value="@phone" required oninput="updateMessage()" />
        </div>
        <div class="form-group mt-2">
            <label for="Message">메시지 내용</label>
            <textarea class="form-control" id="Message" name="Message" rows="2">@(string.IsNullOrEmpty(message) ? defaultMessage : message)</textarea>
        </div>
        <button type="submit" class="btn btn-primary mt-2">카카오톡으로 알림 보내기</button>
    </form>
    @if (ViewBag.Result != null)
    {
        <div class="alert alert-success mt-3">@ViewBag.Result</div>
    }
</div>

<script>
function updateMessage() {
    var phone = document.getElementById('Phone').value || '[전화번호]';
    var number = document.getElementById('Number').value || '[순번]';
    var template = '@defaultMessage'.replace(/'/g, "\'");
    var msg = template.replace('[전화번호]', phone).replace('[순번]', number);
    document.getElementById('Message').value = msg;
}
</script>
